<!-- (c) 2012-2018, Ansible by Red Hat

 This file is part of Ansible Galaxy

 Ansible Galaxy is free software: you can redistribute it and/or modify
 it under the terms of the Apache License as published by
 the Apache Software Foundation, either version 2 of the License, or
 (at your option) any later version.

 Ansible Galaxy is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 Apache License for more details.

 You should have received a copy of the Apache License
 along with Galaxy.  If not, see <http://www.apache.org/licenses/>.
-->

<div id="galaxy-my-namespaces-add">

    <ng-include src="'/static/partials/pageHeaderWidget.html'"></ng-include>

    <div class="container">

        <div class="inner-container">

            <div class="no-github-auth" ng-if="!github_auth">
                <p>Managing namespaces requires authentication. <a href="/accounts/social/connections/">Log into Galaxy in order to continue</a>.</p>
            </div>

            <div ng-if="github_auth">
                <div class="row form-container">
                    <div class="col-sm-12">
                        <h2>Add Galaxy Namespace</h2>
                        <form name="nsAddForm">
                            <div class="form-container">
                                <div class="form-group">
                                    <label for="name">Name <span class="required">*</span></label>
                                    <input type="text" name="name" class="form-control" ng-maxlength="255"
                                           ng-model="namespace.name" required placeholder="Name" ng-change="clearError('name', null)">
                                    <div class="error" ng-show="nsAddForm.name.$dirty && nsAddForm.name.$error.required">
                                        Value is required
                                    </div>
                                    <div class="error" ng-show="nsAddForm.name.$error.maxlength">
                                        Maximum text length exceeded
                                    </div>
                                    <div class="error" ng-show="apiError['name']">
                                        {{ apiError['name'] }}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="description">Description <span class="required">*</span></label>
                                    <input type="text" name="description" class="form-control" ng-maxlength="255" ng-model="namespace.description" required placeholder="Description">
                                    <div class="error" ng-show="nsAddForm.description.$dirty && nsAddForm.description.$error.required">
                                        Value is required
                                    </div>
                                    <div class="error" ng-show="nsAddForm.description.$error.maxlength">
                                        Maximum text length exceeded
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="company">Company</label>
                                    <input type="text" name="company" class="form-control" ng-maxlength="255" ng-model="namespace.company" ng-required placeholder="Company name">
                                    <div class="error" ng-show="nsAddForm.company.$error.maxlength">
                                        Maximum text length exceeded
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="location">Location</label>
                                    <input type="text" name="location" class="form-control" ng-maxlength="255" ng-model="namespace.location" ng-required placeholder="City, State/Provence Country">
                                    <div class="error" ng-show="nsAddForm.location.$error.maxlength">
                                        Maximum text length exceeded
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="avatar_url">Avatar</label>
                                    <input type="url" name="avatarUrl" class="form-control" ng-maxlength="255" ng-model="namespace.avatar_url" placeholder="Avatar URL" ng-pattern="url_regx">
                                    <div class="error" ng-show="nsAddForm.avatarUrl.$error.maxlength">
                                        Maximum text length exceeded
                                    </div>
                                    <div class="error" ng-show="nsAddForm.avatarUrl.$invalid">
                                        Not valid url!
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" name="email" class="form-control" ng-maxlength="255" ng-model="namespace.email" placeholder="Email address">
                                    <div class="error" ng-show="nsAddForm.email.$error.maxlength">
                                        Maximum text length exceeded
                                    </div>
                                    <div class="error" ng-show="nsAddForm.email.$error.email">
                                        Not a valid email address
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="html_url">Web Site</label>
                                    <input type="text" name="htmlUrl" class="form-control" ng-maxlength="255" ng-model="namespace.html_url" placeholder="Web site URL" ng-pattern="url_regx">
                                    <div class="error" ng-show="nsAddForm.htmlUrl.$error.maxlength">
                                        Maximum text length exceeded
                                    </div>
                                    <div class="error" ng-show="nsAddForm.htmlUrl.$invalid">
                                        Not a valid url!
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Owners</label>
                                    <div class="select-list-container">
                                        <div class="help-container">
                                            <button type="button" class="btn btn-default btn-sm add-btn"
                                                tooltip-placement="top"
                                                uib-tooltip="Add an additional owner"
                                                ng-click="addOwner()"><i class="fa fa-plus"></i> Add</button>
                                            <span class="help">Add additional owners. Each owner will have full admin rights to the namespace.</span>
                                        </div>
                                        <div class="select-list">
                                            <div ng-repeat="owner in namespace.owners track by $index">
                                                <div class="input-group select-item">
                                                    <ui-select allow-clear
                                                               ng-model="namespace.owners[$index]"
                                                               spinner-enabled="true"
                                                               on-select="clearError('owners', $index)">
                                                      <ui-select-match placeholder="Select or search by username...">{{$select.selected.username}}</ui-select-match>
                                                      <ui-select-choices refresh="lookupUsers($select.search)"
                                                                         refresh_delay="200"
                                                                         repeat="item in galaxy_users | filter:{username: $select.search}">
                                                        <span ng-bind-html="item.username | highlight: $select.search"></span>
                                                        <span class="select-options github-user" ng-if="item.github_user">(@{{item.github_user}})</span>
                                                      </ui-select-choices>
                                                    </ui-select>
                                                    <span class="input-group-btn">
                                                      <button type="button" ng-click="removeOwner($index)" class="btn btn-default">
                                                        <span class="fa fa-trash"></span>
                                                      </button>
                                                    </span>
                                                </div>
                                                <div class="error" ng-show="apiError['owners'] && apiError['owners'][$index]">
                                                    {{ apiError['owners'][$index] }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Provider Namespaces <span class="required">*</span></label>
                                    <div class="select-list-container">
                                        <div class="help-container">
                                            <button type="button" class="btn btn-default btn-sm add-btn"
                                                tooltip-placement="top"
                                                uib-tooltip="Add an additional provider namespace"
                                                ng-click="addNamespace()"><i class="fa fa-plus"></i> Add</button>
                                            <span class="help">Add provider namespaces. A minimum of one namespace is required.</span>
                                        </div>
                                        <div class="select-list">
                                            <div ng-repeat="ns in namespace.provider_namespaces track by $index">
                                                <div class="input-group select-item">
                                                    <ui-select allow-clear
                                                               ng-model="namespace.provider_namespaces[$index]"
                                                               spinner-enabled="true"
                                                               on-select="clearError('provider_namespaces', $index)">
                                                      <ui-select-match placeholder="Select or search by name...">{{$select.selected.name}}</ui-select-match>
                                                      <ui-select-choices refresh="lookupNamespaces()"
                                                                         refresh_delay="200"
                                                                         repeat="item in provider_namespaces | filter:{name: $select.search}">
                                                        <span ng-bind-html="item.name | highlight: $select.search"></span>
                                                        <span class="select-options github-user" ng-if="item.display_name">({{item.display_name}})</span>

                                                      </ui-select-choices>
                                                    </ui-select>
                                                    <span class="input-group-btn">
                                                      <button type="button" ng-click="removeNamespace($index)" class="btn btn-default">
                                                        <span class="fa fa-trash"></span>
                                                      </button>
                                                    </span>
                                                </div>
                                                <div class="error" ng-show="apiError['provider_namespaces'] && apiError['provider_namespaces'][$index]">
                                                    {{ apiError['provider_namespaces'][$index] }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="row form-buttons">
                    <div class="col-sm-12">
                        <button type="submit" class="btn btn-success btn-md"
                                tooltip-placement="top"
                                uib-tooltip="Save the new namespace"
                                ng-disabled="!nsAddForm.$dirty || nsAddForm.$invalid || !validNamespaces() || hasApiErrors()"
                                ng-click="saveNamespace(nsAddForm)">Save</button>
                        <a href="#/namspaces" class="btn btn-default btn-md"
                                tooltip-placement="top"
                                uib-tooltip="Return to the previous page">Cancel</a>
                        <div class="form-message" ng-show="hasApiErrors()">
                            <span class="required">One or more errors were found. See the message under each value needing your attention.</span>
                        </div>
                        <div class="form-message" ng-show="!hasApiErrors()">
                            <span class="required">*</span> Indicates a required field. Provide a value for all required fields, and correct any indicated errors before continuing.
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>