angular.module("ui.slider",[]).value("uiSliderConfig",{}).directive("uiSlider",["uiSliderConfig","$timeout",function(a,b){a=a||{};return{require:"ngModel",compile:function(){return function(c,d,g,e){function h(a,b){return b?parseFloat(a):parseInt(a)}var f=angular.extend(c.$eval(g.uiSlider)||{},a),m=null,k=null,l=function(){angular.isArray(e.$viewValue)&&!0!==f.range&&(console.warn("Change your range option of ui-slider. When assigning ngModel an array of values then the range option should be set to true."),
f.range=!0);d.slider(f);l=angular.noop},n=angular.isUndefined(g.useDecimals)?!1:!0;angular.forEach(["min","max","step"],function(a,b){g.$observe(a,function(b){b&&(l(),d.slider("option",a,h(b,n)))})});g.$observe("disabled",function(a){l();d.slider("option","disabled",!!a)});c.$watch(g.uiSlider,function(a){l();d.slider("option",a)},!0);b(l,0,!0);d.bind("slide",function(a,b){e.$setViewValue(b.values||b.value);c.$apply()});e.$render=function(){l();var a=!0===f.range?"values":"value";isNaN(e.$viewValue)&&
(e.$viewValue=0);!0===f.range&&(angular.isDefined(f.min)&&f.min>e.$viewValue[0]&&(e.$viewValue[0]=f.min),angular.isDefined(f.max)&&f.max<e.$viewValue[1]&&(e.$viewValue[1]=f.max),e.$viewValue[0]>=e.$viewValue[1]&&(m>=e.$viewValue[1]&&(e.$viewValue[0]=m),k<=e.$viewValue[0]&&(e.$viewValue[1]=k)),m=e.$viewValue[0],k=e.$viewValue[1]);d.slider(a,e.$viewValue)};c.$watch(g.ngModel,function(){!0===f.range&&e.$render()},!0);d.bind("$destroy",function(){d.slider("destroy")})}}}}]);var roleApp=angular.module("roleApp","ngRoute ngSanitize ngCookies ui.bootstrap ui.slider listControllers listDirectives meServices categoryServices ratingServices roleServices storageServices userServices relatedService Paginate".split(" "));function getMyInfo(a,b){var c=a.defer();b.fetchMyInfo().success(function(a){b.saveInfo(a);c.resolve(a)}).error(function(a){c.reject(a)});return c.promise}
roleApp.config(["$routeProvider",function(a){a.when("/roles",{templateUrl:"/static/partials/role-list.html",controller:"RoleListCtrl",reloadOnSearch:!1,resolve:{my_info:["$q","meFactory",getMyInfo]}}).when("/roles/category/:category_name",{templateUrl:"/static/partials/role-list.html",controller:"RoleListCtrl",resolve:{my_info:["$q","meFactory",getMyInfo]}}).when("/roles/sort/:sort_order",{templateUrl:"/static/partials/role-list.html",controller:"RoleListCtrl",resolve:{my_info:["$q","meFactory",getMyInfo]}}).when("/roles/:role_id",
{templateUrl:"/static/partials/role-detail.html",controller:"RoleDetailCtrl",resolve:{my_info:["$q","meFactory",getMyInfo]}}).when("/users",{templateUrl:"/static/partials/user-list.html",controller:"UserListCtrl",resolve:{my_info:["$q","meFactory",getMyInfo]}}).when("/users/sort/:sort_order",{templateUrl:"/static/partials/user-list.html",controller:"UserListCtrl",resolve:{my_info:["$q","meFactory",getMyInfo]}}).when("/users/:user_id",{templateUrl:"/static/partials/user-detail.html",controller:"UserDetailCtrl",
resolve:{my_info:["$q","meFactory",getMyInfo]}}).otherwise({redirectTo:"/roles"})}]);var listControllers=angular.module("listControllers",["Utilities","Search"]);function from_query_params(a){var b={};b.list_filter=a.f;b.page=a.page;b.results_per_page=a.per_page;b.sort_order=a.sort_order;b.reverse=a.reverse;b.selected_categories=a.cats;return b}function query_params(a){var b={};a.list_filter&&(b.f=a.list_filter);b.page=a.page;b.per_page=a.results_per_page;b.sort_order=a.sort_order;a.reverse&&(b.reverse=a.reverse);a.selected_categories&&(b.cats=a.selected_categories);return b}
listControllers.controller("RoleListCtrl",["$scope","$routeParams","$location","$timeout","roleFactory","categoryFactory","queryStorageFactory","my_info","Empty","SearchInit","PaginateInit",function(a,b,c,d,g,e,h,f,m,k,l){a.page_title="Browse Roles";a.my_info=f;a.list_data={list_filter:"",num_pages:1,page:1,results_per_page:10,reverse:!1,selected_categories:[],sort_order:"owner__username,name",refresh:function(){h.save_state("role_list",query_params(a.list_data));a.list_data.sort_order=a.getSortOrder();
a.loading=1;g.getRoles(a.list_data.page,a.list_data.selected_categories,a.list_data.results_per_page,a.list_data.sort_order,a.list_data.list_filter,a.list_data.reverse).success(function(b){a.roles=b.results;a.list_data.page=parseInt(b.cur_page);a.list_data.num_pages=parseInt(b.num_pages);a.list_data.page=a.list_data.page||1;a.list_data.num_pages=a.list_data.num_pages||1;a.num_roles=parseInt(b.count);a.list_data.page_range=[];a.setPageRange();a.status="";h.save_state("role_list",query_params(a.list_data));
a.loading=0;a.hasPerformedSearches=!0;window.scrollTo(0,0)}).error(function(b){a.roles=[];a.list_data.page=1;a.list_data.num_pages=1;a.list_data.page_range=[1];a.num_roles=0;a.status="Unable to load roles list: "+b.message;a.loading=0})}};a.page_range=[1];a.categories=[];a.roles=[];a.num_roles=0;a.status="";a.loading=0;a.viewing_roles=1;a.display_user_info=1;l({scope:a});a.getCategories=function(){e.getCategories("name",!0).success(function(b){a.categories=b;for(var d=[],c=0;c<b.length;c++)d.push(b[c].name);
a.tags=d;$("#categories-select").select2({width:"100%",tags:d,placeholder:"Categories",tokenSeparators:[","," "]});$("#categories-select").on("change",function(){a.change_category()});0<a.list_data.selected_categories.length&&$("#categories-select").val(a.list_data.selected_categories).trigger("change")}).error(function(a){})};a.is_selected=function(b){return-1!=a.list_data.selected_categories.indexOf(b)?!0:!1};a.change_category=function(){a.list_data.selected_categories=$("#categories-select").select2("val");
a.list_data.refresh()};a.pick_category=function(b){for(var d=!1,c=0;c<a.list_data.selected_categories.length;c++)if(a.list_data.selected_categories[c]==b){d=!0;break}d||(a.list_data.selected_categories.push(b),$("#categories-select").val(a.list_data.selected_categories).trigger("change"))};a.toggle_reverse=function(){a.list_data.reverse=!a.list_data.reverse;a.list_data.refresh()};a.toggle_category=function(b){var d=a.list_data.selected_categories.indexOf(b);-1!=d?a.list_data.selected_categories.splice(d,
1):a.list_data.selected_categories.push(b);c.path("roles");a.list_data.refresh()};a.clear_categories=function(){c.path("roles");a.list_data.selected_categories=[];a.list_data.page=1;a.list_data.refresh()};d=h.restore_state("role_list",query_params(a.list_data));a.list_data=angular.extend({},a.list_data,from_query_params(d));b.category_name&&(a.list_data.selected_categories=[b.category_name]);if(b.sort_order)switch(b.sort_order){case "sort-by-community-score":a.list_data.sort_order="average_score,name";
a.list_data.reverse=!0;break;case "sort-by-created-on-date":a.list_data.sort_order="created",a.list_data.reverse=!0}a.noSearchResults=function(){return 0==a.roles.length&&a.hasPerformedSearches};a.hasSearchResults=function(){return 0<a.roles.length&&a.hasPerformedSearches};k({scope:a,placeHolder:"Search role name",showSearchIcon:a.list_data.list_filter?!1:!0,sortOptions:[{value:"name",label:"Role Name"},{value:"owner__username,name",label:"Owner Name"},{value:"average_score,name",label:"Average Score"},
{value:"created",label:"Create On Date"}],sortOrder:a.list_data.sort_order});a.getCategories();a.list_data.refresh()}]);
listControllers.controller("RoleDetailCtrl",["$q","$scope","$routeParams","$location","$modal","$compile","roleFactory","userFactory","ratingFactory","meFactory","relatedFactory","my_info","Stars","PaginateInit",function(a,b,c,d,g,e,h,f,m,k,l,n,p,r){function q(a){var b;switch(a){case "avg_wow_factor":b="Wow! Factor";break;case "avg_documentation":b="Documentation";break;case "avg_reliability":b="Reliability";break;case "avg_code_quality":b="Code Quality";break;case "average_score":b="Community Score"}return b}
b.page_title="Role Detail";b.showRoleName=!1;b.my_info=n;b.list_data={ratings:{list_filter:"",num_pages:1,page:1,results_per_page:10,reverse:!1,selected_categories:[],sort_order:"created",refresh:function(){b.$emit("getRelated","ratings",b.role.related.ratings)}}};b.role={num_ratings:0};b.ratings=[];b.display_user_info=1;r({scope:b});b.removeInsertRatings&&b.removeInsertRatings();b.removeInsertRatings=b.$on("insertRatings",function(a,d,c){a="<table>\n<tbody>\n";var g=d[c];g.average_score=d.average_score;
d=0;for(var f in g){d++;var n=parseFloat(g[f]);b[c+"_"+f+"_ceil"]=Math.ceil(n);b[c+"_"+f+"_states"]=[];for(var l=0;l<Math.floor(n);l++)b[c+"_"+f+"_states"].push({stateOn:"fa fa-star",stateOff:"fa fa-star-o"});0<n%1&&b[c+"_"+f+"_states"].push({stateOn:"fa fa-star-half-o",stateOff:"fa fa-star-half-o"});for(l=b[c+"_"+f+"_states"].length;5>l;l++)b[c+"_"+f+"_states"].push({stateOn:"fa fa-star-o"})}d=q("average_score");a=a+('<tr class="primary-score"><td ng-mouseenter="startHover(\''+c+"', 'average_score')\" ng-mouseleave=\"stopHover('"+
c+"', 'average_score')\">"+d+"</td>\n")+('<td><rating value="5" readonly="true" rating-states="'+c+'_average_score_states" on-hover="startHover(\''+c+"', 'average_score')\" on-leave=\"stopHover('"+c+"', 'average_score')\"></rating>\n");a+='<span class="badge" ng-show="'+c+'_average_score_over">{{ role.average_score | number:1 }}</span>\n';a+="</td></tr>\n";delete g.average_score;for(f in g)d=q(f),a+="<tr><td ng-mouseenter=\"startHover('"+c+"', '"+f+"')\" ng-mouseleave=\"stopHover('"+c+"', '"+f+"')\">"+
d+"</td>\n",a+='<td><rating value="5" readonly="true" rating-states="'+c+"_"+f+'_states" on-hover="startHover(\''+c+"', '"+f+"')\" on-leave=\"stopHover('"+c+"', '"+f+"')\"></rating>\n",a+='<span class="badge" ng-show="'+c+"_"+f+'_over">{{ role.'+c+"."+f+" | number:1 }}</span>\n",a+="</td></tr>\n";a+="</tbody>\n</table>\n";g.average_score;c=angular.element(document.getElementById(c+"_breakdown"));c.html(a);e(c)(b)});b.startHover=function(a,c){b[a+"_"+c+"_over"]=!0};b.stopHover=function(a,c){b[a+"_"+
c+"_over"]=!1};b.ratingHover=function(a,c,d){b[c+"_hover_"+a]=d};b.scrollToRatingForm=function(){d.hash("review-role")};b.getRole=function(){h.getRole(c.role_id).success(function(a){b.role=a;b.$emit("insertRatings",a,"average_composite");b.$emit("getRelated","ratings",a.related.ratings)}).error(function(a){b.status="Unable to load role: "+a.message})};b.addVote=function(a,c){m.addVote(a,{id:n.id},c).success(function(a){b.$emit("getRelated","ratings",b.role.related.ratings)}).error(function(a){})};
b.removeRelated&&b.removeRelated();b.removeRelated=b.$on("getRelated",function(a,c,d){b.list_data[c].url=d;l.getRelated(b.list_data[c]).success(function(a){b.list_data[c].page=parseInt(a.cur_page);b.list_data[c].num_pages=parseInt(a.num_pages);b.list_data[c].page_range=[];b.setPageRange(c);for(var d=0;d<a.results.length;d++)a.results[d].reliability_range=p(a.results[d].reliability),a.results[d].documentation_range=p(a.results[d].documentation),a.results[d].code_quality_range=p(a.results[d].code_quality),
a.results[d].wow_factor_range=p(a.results[d].wow_factor),a.results[d].score_range=p(a.results[d].score);b[c]=a.results}).error(function(a){b.status="Unable to load related "+c+": "+a.message})});var s=function(a,b,c,d,f){a.alerts=[];a.role=c;a.rating=f?f:{reliability:0,documentation:0,code_quality:0,wow_factor:0,comment:""};a.closeAlert=function(b){a.alerts.splice(b,1)};a.ok=function(){if(0==a.rating.reliability||0==a.rating.documentation||0==a.rating.code_quality||0==a.rating.wow_factor)a.alerts=
[{type:"danger",msg:"You must choose a rating for each category"}];else{var f={pk:a.role.id};angular.extend(f,a.rating);d.addRating(c.related.ratings,f).success(function(a){b.close(!0)}).error(function(b,c){console.log(c);a.alerts=[{type:"danger",msg:403==c?"You do not have permission to add a rating to this role.":409==c?"You appear to have already rated this role. If your rating is not visible, it may mean that an administrator has removed it for violating our terms of service. If you believe this was done in error, please contact us.":
"An unknown error occurred while trying to add your rating. Please wait a while and try again."}]})}};a.cancel=function(){b.dismiss("cancel")}};b.showRatingDialog=function(){n.authenticated&&g.open({templateUrl:"/static/partials/add-rating.html",controller:s,resolve:{role:function(){return b.role},ratingFactory:function(){return m},rating:function(){var c=a.defer();m.getMyRatingForRole(n.id,b.role.id).success(function(a){0<a.count?(a=angular.copy(a.results[0]),a={id:a.id,reliability:parseInt(a.reliability),
documentation:parseInt(a.documentation),code_quality:parseInt(a.code_quality),wow_factor:parseInt(a.wow_factor),comment:a.comment},c.resolve(a)):c.resolve(null)}).error(function(a){c.reject(a)});return c.promise}}}).result.then(function(a){a&&b.getRole()})};b.staffDeleteRating=function(a){m.deleteRating(a).success(function(a){b.getRole()}).error(function(b){alert("Failed to remove rating "+a+", reason: "+b)})};b.staffDeleteRole=function(a){h.deleteRole(a).success(function(a){d.path("/roles")}).error(function(b){alert("Failed to remove role "+
a+", reason: "+b)})};b.getRole()}]);
listControllers.controller("UserListCtrl",["$scope","$timeout","$location","$routeParams","userFactory","queryStorageFactory","my_info","SearchInit","PaginateInit","Stars",function(a,b,c,d,g,e,h,f,m,k){a.page_title="Browse Users";a.my_info=h;a.hasPerformedSearches=!1;a.list_data={list_filter:"",num_pages:1,page:1,results_per_page:10,reverse:!1,selected_categories:[],sort_order:"username",refresh:function(){e.save_state("user_list",query_params(a.list_data));a.list_data.sort_order=a.getSortOrder();
console.log("sort order is "+a.list_data.sort_order);a.loading=1;g.getUsers(a.list_data.page,a.list_data.results_per_page,a.list_data.sort_order,a.list_data.reverse,a.list_data.list_filter).success(function(b){for(var c=0;c<b.results.length;c++)b.results[c].karma_range=k(b.results[c].karma),b.results[c].avg_rating_range=k(b.results[c].avg_rating),b.results[c].avg_role_score_range=k(b.results[c].avg_role_score),b.results[c].avg_role_aw_score_range=k(b.results[c].avg_role_score),b.results[c].rating_range=
0<b.results[c].summary_fields.ratings.length?k(b.results[c].summary_fields.ratings[0].score):k(0);b.results.length&&(a.users=angular.copy(b.results));a.list_data.page=parseInt(b.cur_page);a.list_data.num_pages=parseInt(b.num_pages);a.num_users=parseInt(b.count);a.list_data.page_range=[];a.setPageRange();a.status="";e.save_state("user_list",query_params(a.list_data));a.loading=0;a.hasPerformedSearches=!0;window.scrollTo(0,0)}).error(function(b){a.users=[];a.num_users=0;a.list_data.page=1;a.list_data.num_pages=
1;a.list_data.page_range=[1];a.status="Unable to load users list: "+b.message;a.loading=0})}};a.page_range=[1];a.categories=[];a.users=[];a.num_users=0;a.status="";a.loading=0;a.viewing_users=1;m({scope:a});a.noSearchResults=function(){return 0==a.users.length&&a.hasPerformedSearches};a.hasSearchResults=function(){return 0<a.users.length&&a.hasPerformedSearches};a.hover=function(b,c,d){a[c+"_hover_"+b]=d};a.toggle_reverse=function(){a.list_data.reverse=!a.list_data.reverse;a.list_data.refresh()};
b=e.restore_state("user_list",query_params(a.list_data));a.list_data=angular.extend({},a.list_data,from_query_params(b));if(d.sort_order)switch(d.sort_order){case "sort-by-community-score":a.list_data.sort_order="avg_role_score,username";a.list_data.reverse=!0;break;case "sort-by-joined-on-date":a.list_data.sort_order="date_joined,username";a.list_data.reverse=!0;break;case "sort-by-top-reviewers":a.list_data.sort_order="karma,username",a.list_data.reverse=!0}f({scope:a,placeHolder:"Search user",
showSearchIcon:a.list_data.list_filter?!1:!0,sortOptions:[{value:"username",label:"Username"},{value:"karma,username",label:"Karma Score"},{value:"avg_role_score,username",label:"Average Role Score"},{value:"num_roles,username",label:"Number of Roles"},{value:"date_joined,username",label:"Date Joined"}],sortOrder:a.list_data.sort_order});a.list_data.refresh()}]);
listControllers.controller("UserDetailCtrl",["$scope","$routeParams","$location","userFactory","ratingFactory","my_info","Range","relatedFactory","Empty","Stars","PaginateInit",function(a,b,c,d,g,e,h,f,m,k,l){a.my_info=e;a.page_title="User Detail";a.showRoleName=!0;a.my_info=e;a.hasPerformedSearches=!1;a.list_data={roles:{list_filter:"",num_pages:1,page:1,results_per_page:10,reverse:!1,selected_categories:[],sort_order:"name",refresh:function(){a.$emit("refreshRelated","roles",a.user.related.roles)}},
ratings:{list_filter:"",num_pages:1,page:1,results_per_page:10,reverse:!0,selected_categories:[],sort_order:"created",refresh:function(){a.$emit("refreshRelated","ratings",a.user.related.ratings)}}};a.user={num_roles:0,num_ratings:0};a.roles=[];a.ratings=[];l({scope:a});a.display_role_info=1;a.display_user_info=0;a.getUser=function(){d.getUser(b.user_id).success(function(b){a.user=b;a.list_data.roles.refresh();a.list_data.ratings.refresh()}).error(function(b){a.status="Unable to load user: "+b.message})};
a.ratingHover=function(b,c,d){a[c+"_hover_"+b]=d};a.addVote=function(b,c){g.addVote(b,{id:e.id},c).success(function(b){a.$emit("refreshRelated","ratings",a.user.related.ratings)}).error(function(a){console.error("failed to add a "+c+" vote on rating id="+b)})};a.removeRelated&&a.removeRelated();a.removeRelated=a.$on("refreshRelated",function(b,c,d){a.list_data[c].url=d;f.getRelated(a.list_data[c]).success(function(b){a.list_data[c].page=parseInt(b.cur_page);a.list_data[c].num_pages=parseInt(b.num_pages);
a.list_data[c].page_range=[];a.setPageRange(c);if(0<b.results.length&&!m(b.results[0].reliability))for(var d=0;d<b.results.length;d++)b.results[d].reliability_range=k(b.results[d].reliability),b.results[d].documentation_range=k(b.results[d].documentation),b.results[d].code_quality_range=k(b.results[d].code_quality),b.results[d].wow_factor_range=k(b.results[d].wow_factor),b.results[d].score_range=k(b.results[d].score);a[c]=b.results}).error(function(b){a.status="Unable to load related "+c+": "+b.message})});
a.staffDeleteRating=function(b){g.deleteRating(b).success(function(b){a.getUser()}).error(function(a){alert("Failed to remove rating "+b+", reason: "+a)})};a.staffDeleteUser=function(a){d.deleteUser(a).success(function(a){c.path("/users")}).error(function(b){alert("Failed to remove user "+a+", reason: "+b)})};a.getUser()}]);listControllers.filter("avatarSize",function(){return function(a,b){if(a)return a.replace("s=96","s="+b)}});var categoryServices=angular.module("categoryServices",["ngResource"]);categoryServices.factory("categoryFactory",["$http",function(a){return{getCategories:function(b,c){var d="/api/v1/categories/?";return a.get(c?d+("order_by=-"+b):d+("order_by="+b))}}}]);var meServices=angular.module("meServices",["ngResource"]);meServices.factory("meFactory",["$http","$q","storageFactory",function(a,b,c){var d={default_state:{id:null,authenticated:0,username:"",timestamp:null},getMyCachedInfo:function(){return c.restore_state("my_info",d.default_state)},saveInfo:function(a){a=angular.copy(a);a.timestamp=new Date;c.save_state("my_info",a)},fetchMyInfo:function(){return a.get("/api/v1/me/")}};return d}]);
function MyInfoProviderFunction(){this.$get=["$q","meFactory",function(a,b){var c=a.defer();b.fetchMyInfo().success(function(a){c.resolve(a)}).error(function(a){c.reject(a)});return c.promise}]}meServices.provider("MyInfo",MyInfoProviderFunction);var ratingServices=angular.module("ratingServices",["ngResource"]);
ratingServices.factory("ratingFactory",["$http","$cookies",function(a,b){var c={};a.defaults.headers.common["X-CSRFToken"]=b.csrftoken;c.getRatings=function(b,c,e,h){b="/api/v1/ratings/?page="+b+"&order_by="+e+"&page_size="+c;h&&""!=h&&(b+="&owner__username__contains="+h);return a.get(b)};c.getRating=function(b){return a.get("/api/v1/ratings/"+b)};c.getLatest=function(a,b){return c.getRatings(a,b,"-created")};c.addRating=function(b,c){return a.put(b,c)};c.deleteRating=function(b){return a.delete("/api/v1/ratings/"+
b+"/")};c.addVote=function(b,c,e){return a.post("/api/v1/ratings/"+b+"/"+e+"_votes/",c)};c.getMyRatingForRole=function(b,c){return a.get("/api/v1/ratings/?owner="+b+"&role="+c)};return c}]);var roleServices=angular.module("roleServices",["ngResource"]);
roleServices.factory("roleFactory",["$http","$cookies",function(a,b){var c={};a.defaults.headers.common["X-CSRFToken"]=b.csrftoken;c.getRoles=function(b,c,e,h,f,m){b="/api/v1/roles/?page="+b+"&page_size="+e;if(0<c.length)for(var k in c)b+="&chain__categories__name="+c[k];f&&""!=f&&(b+="&name__icontains="+f);if(m){c=h.split(",");for(var l in c)c[l]="-"+c[l];h=c.join(",")}return a.get(b+("&order_by="+h))};c.getRole=function(b){return a.get("/api/v1/roles/"+b+"/")};c.getLatest=function(a,b,e,h){h&&(e=
"-"+e);return c.getRoles(a,[],b,e)};c.deleteRole=function(b){return a.delete("/api/v1/roles/"+b+"/")};return c}]);var storageServices=angular.module("storageServices",["ngResource"]);function defineStorageService(a){return{save_state:function(b,c){var d={},g;for(g in c)d[g]=c[g];a.save(b,d)},restore_state:function(b,c){try{var d=a.restore(b),g;for(g in c)"undefined"==typeof d[g]&&(d[g]=c[g]);return d}catch(e){return c}}}}storageServices.factory("queryStorageFactory",["$location",function(a){return defineStorageService({save:function(b,c){return a.search(JSON.parse(JSON.stringify(c)))},restore:function(){return a.search()}})}]);
storageServices.factory("storageFactory",[function(){return defineStorageService({save:function(a,b){localStorage[a]=JSON.stringify(b);return localStorage[a]},restore:function(a){return JSON.parse(localStorage[a])}})}]);var userServices=angular.module("userServices",["ngResource"]);
userServices.factory("userFactory",["$http","$cookies",function(a,b){var c={};a.defaults.headers.common["X-CSRFToken"]=b.csrftoken;c.getUsers=function(b,c,e,h,f){h&&(e="-"+e);b="/api/v1/users/?page="+b+"&page_size="+c+("&order_by="+e);f&&""!=f&&(b+="&or__username__icontains="+f+"&or__full_name__icontains="+f);return a.get(b)};c.getUser=function(b){return a.get("/api/v1/users/"+b)};c.getUserRelated=function(b,c,e,h,f){f&&(h="-"+h);b=b+"?page="+c+"&page_size="+e+("&order_by="+h);return a.get(b)};c.deleteUser=
function(b){return a.delete("/api/v1/users/"+b+"/")};return c}]);angular.module("Utilities",[]).factory("Empty",[function(){return function(a){return void 0===a||null===a||""===a?!0:!1}}]).factory("Range",[function(){return function(a,b){for(var c=[],d=0;d<a;d++)c.push({id:d,value:b});return c}}]).factory("Stars",[function(){return function(a){var b=[];a=parseFloat(a);for(var c=Math.floor(a),d=0;d<c;d++)b.push({id:d,value:"fa fa-star"});0<a%1&&b.push({id:d,value:"fa fa-star-half-o"});for(d=b.length;5>d;d++)b.push({id:d,value:"fa fa-star-o"});return b}}]);angular.module("Search",["Utilities"]).factory("SearchInit",["Empty",function(a){return function(b){var c=b.scope;c.searchPlaceHolder=b.placeHolder;c.sort_options=b.sortOptions;c.showSearchIcon=b.showSearchIcon;c.sort={obj:{}};c.setSortOrder=function(a){for(var b=!1,e=0;e<c.sort_options.length;e++)if(c.sort_options[e].value==a){c.sort.obj=c.sort_options[e];b=!0;break}return b};c.setSortOrder(b.sortOrder);c.getSortOrder=function(){void 0==c.sort.obj&&(c.sort.obj=c.sort_options[0]);return c.sort.obj.value};
c.toggleSearchIcon=function(){c.showSearchIcon&&!a(c.list_data.list_filter)?c.showSearchIcon=!1:c.showSearchIcon||(c.list_data.list_filter=null,c.showSearchIcon=!0);c.list_data.refresh()};c.applyFilter=function(b){13==b.keyCode&&(c.list_data.refresh(),a(c.list_data.list_filter)?c.showSearchIcon=!0:c.showSearchIcon=!1)}}}]);var relatedService=angular.module("relatedService",["ngResource"]);relatedService.factory("relatedFactory",["$http",function(a){return{getRelated:function(b){var c=b.sort_order,d=b.url+"?page="+b.page+"&page_size="+b.results_per_page;b.reverse&&(c="-"+c);return a.get(d+("&order_by="+c))}}}]);angular.module("Paginate",[]).factory("PaginateInit",[function(){return function(a){var b=a.scope;b.getPage=function(a,d){console.log("target is "+d);data=d?b.list_data[d]:b.list_data;data.page=a;data.refresh()};b.setPageRange=function(a){data=a?b.list_data[a]:b.list_data;a=0==data.page%10?10*Math.floor((data.page-1)/10)+1:10*Math.floor(data.page/10)+1;a=0>=a?1:a;for(var d=10*Math.ceil(data.page/10),d=d>data.num_pages?data.num_pages:d,g=a;g<=d;g++)data.page_range.push(g);data.next_page=d+1;data.previous_page=
a-1}}}]);var listDirectives=angular.module("listDirectives",[]);
listDirectives.directive("ratingForm",function(){return{restrict:"EA",templateUrl:"/static/partials/rating-form.html",transclude:!0,scope:{role:"="},controller:["$scope","$q","ratingFactory","meFactory",function(a,b,c,d){function g(a){a=a.data;if(0==a.count)return null;a=angular.copy(a.results[0]);return{id:a.id,reliability:parseInt(a.reliability),documentation:parseInt(a.documentation),code_quality:parseInt(a.code_quality),wow_factor:parseInt(a.wow_factor),comment:a.comment}}function e(b){a.rating=
b?b:{reliability:0,documentation:0,code_quality:0,wow_factor:0,comment:""}}if(!angular.isUndefined(a.role)){d=b.when(d.getMyCachedInfo());d=d.then(function(b){return a.my_info=b});var h=b.when(a.role);b.all([d,h]).then(function(a){return c.getMyRatingForRole(a[0].id,a[1].id)}).then(g).then(e);a.alerts=[];a.closeAlert=function(b){a.alerts.splice(b,1)};a.ok=function(){if(0==a.rating.reliability||0==a.rating.documentation||0==a.rating.code_quality||0==a.rating.wow_factor)a.alerts=[{type:"danger",msg:"You must choose a rating for each category"}];
else{var b={pk:a.role.id};angular.extend(b,a.rating);c.addRating(a.role.related.ratings,b).error(function(b,c){a.alerts=[{type:"error",msg:403==c?"You do not have permission to add a rating to this role.":409==c?"You appear to have already rated this role. If your rating is not visible, it may mean that an administrator has removed it for violating our terms of service. If you believe this was done in error, please contact us.":"An unknown error occurred while trying to add your rating. Please wait a while and try again."}]})}};
a.cancel=function(){$modalInstance.dismiss("cancel")}}}],link:function(){}}});listDirectives.directive("ratingStars",function(){return{restrict:"E",scope:{rating:"@"},link:function(a,b,c){console.log("ratingStars: ",c);console.log("rating: ",c.rating);console.log(Array(Math.floor(c.rating)).length)}}});
