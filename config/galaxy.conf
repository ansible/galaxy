NameVirtualHost *:8080
WSGISocketPrefix /var/run/wsgi

<VirtualHost _default_:8080>
  RewriteEngine on
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

  ServerName localhost
  ServerAlias localhost 127.0.0.1
  DocumentRoot /var/lib/galaxy/public

  CustomLog "/var/log/httpd/galaxy_access.log" common
  ErrorLog "/var/log/httpd/galaxy_error.log"

  WSGIScriptAlias / /var/lib/galaxy/wsgi.py
  WSGIPassAuthorization On

  WSGIDaemonProcess galaxy_http processes=2 threads=20 maximum-requests=1000 display-name="%{GROUP}-http"
  WSGIProcessGroup galaxy_http

  Alias /favicon.ico /var/lib/galaxy/public/static/favicon.ico
  Alias /static/ /var/lib/galaxy/public/static/

  <Directory /var/lib/galaxy/>
    <Files wsgi.py>
      Order deny,allow
      Allow from all
    </Files>
  </Directory>

  <Directory /var/lib/galaxy/public/>
    Order deny,allow
    Allow from all
  </Directory>
</VirtualHost>

<VirtualHost _default_:8443>
 ServerName localhost
 ServerAlias localhost
 ServerAlias 127.0.0.1
 DocumentRoot /var/lib/galaxy/public

 SSLEngine on
 SSLCertificateFile /etc/pki/tls/certs/localhost.crt
 SSLCertificateKeyFile /etc/pki/tls/private/localhost.key

 WSGIScriptAlias / /var/lib/galaxy/wsgi.py
 WSGIPassAuthorization On

 # FIXME: May want to tune these parameters after performance testing.
 WSGIDaemonProcess galaxy_https processes=2 threads=20 maximum-requests=1000 display-name="%{GROUP}-https"
 WSGIProcessGroup galaxy_https

 Alias /favicon.ico /var/lib/galaxy/public/static/favicon.ico
 Alias /static/ /var/lib/galaxy/public/static/

 <Directory /var/lib/galaxy/>
   <Files wsgi.py>
     Order deny,allow
     Allow from all
   </Files>
 </Directory>

 <Directory /var/lib/galaxy/public/>
   Order deny,allow
   Allow from all
 </Directory>
</VirtualHost>

